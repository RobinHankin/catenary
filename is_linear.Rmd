---
title: "Is a perturbed catenary linear?"
author: "robin hankin"
date: "2026-02-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r defcat}
y <- function(x, params){
  x0 <- params[1]
  y0 <- params[2]
  a  <- params[3]
  return(y0 + a*cosh((x-x0)/a))
}

ydash <- function(x, params){
  x0 <- params[1]
  y0 <- params[2]
  a  <- params[3]
  return(sinh((x-x0)/a))
}

tensionX <- function(x, params){  # NB  for unit weight per unit length
  x0 <- params[1]
  y0 <- params[2]
  a  <- params[3]

  return(a)
}

tensionY <- function(x, params){  # NB  for unit weight per unit length
  x0 <- params[1]
  y0 <- params[2]
  a  <- params[3]

  return(a*sinh((x-x0)/a))
}

arclength <- function(x, params){  # NB indefinite integral, hence K
  x0 <- params[1]
  y0 <- params[2]
  a  <- params[3]

  K <- -pi*7e2  # constant of integration
  return(a*sinh((x-x0)/a) + K)
}

intersection <- function(params1, params2){

    f <- function(x){(y(x,params1) - y(x,params2))^2}
    out <- optimize(f, interval= c(-100, 100))
    return(c(out$minimum, out$objective))
}
    
```

Need to find `ap <- c(x01, y01, a1, x02, y02, a2, xF, yF)`.  This is eight equations.

$f_1(x)=y_0^{(1)}+a^{(1)}\cosh\left(\frac{x-x_0^{(1)}}{a^{(1)}}\right)$ and
$f_2(x)=y_0^{(2)}+a^{(2)}\cosh\left(\frac{x-x_0^{(2)}}{a^{(2)}}\right)$.

\begin{eqnarray}
f_1(x_1) &=& y_1\qquad\mbox{string 1 goes through left anchor point}\\
f_2(x_2) &=& y_2\qquad\mbox{string 2 goes throught right anchor point}\\
T_1(x_F)\sin\theta_1 - T_2(x_F)\sin\theta_2 + F_y &=& 0
\qquad\mbox{vertical forces at force point balance}\\
T_1(x_F)\cos\theta_1 - T_2(x_F)\cos\theta_2 + F_x &=& 0
\qquad\mbox{horizontal forces at force point balance}\\
\int_{x=x_1}^{x_F}\sqrt{1+(y_1)'^2}\,dx &=& L_1\qquad\mbox{string 1 of length $L_1$}\\
\int_{x=x_F}^{x_2}\sqrt{1+(y_2)'^2}\,dx &=& L_2\qquad\mbox{string 2 of length $L_2$}
\end{eqnarray}


First specify the knowns:

```{r doknowns}
knowns  <-
    list(
        x1  =  -1,
        y1  =  1,
        x2  =  2,
        y2  =  2,
        rho1  =  5,
        rho2  =  1,
        L1  =  2,
        L2  =  4,
        Fx  =  0,  # x-component of force
        Fy  =  3 # y-component of force
    )
```

```{r defbad}
badness <- function(params1, params2, pF, knowns){
    attach(knowns)

    xF <- pF[1]
    yF <- pF[2]

    L1_est <- arclength(xF, params1) - arclength(x1, params1) # "est" = estimated
    L2_est <- arclength(x2, params2) - arclength(xF, params2)

    ## all mismatch variables are zero at a solution.


    mismatch1 <- y(x1, params1) - y1  # string 1 meets left anchor point
    mismatch2 <- y(x2, params2) - y2  # string 2 meets right anchor point

    mismatch3 <- y(xF, params1) - yF  # string 1 meets force point
    mismatch4 <- y(xF, params2) - yF  # string 2 meets force point

    mismatch5 <- # Total horizontal forces on force point (xF,yF)
        (
            -rho1 * tensionX(xF, params1)  # force to the left is negative
            +rho2 * tensionX(xF, params2) 
            +Fx # external horizontal force at force point
        )

    mismatch6 <- # Total vertical forces on force point (xF, yF)
        (
            -rho1 * tensionY(xF, params1) # F>0 if y' < 0
            +rho2 * tensionY(xF, params2) # F>0 if y' > 0
            +Fy # external vertical force at force point
        )
    
    
    mismatch7 <- L1_est - L1
    mismatch8 <- L2_est - L2

    bad1 <- mismatch1^2
    bad2 <- mismatch2^2
    bad3 <- mismatch3^2
    bad4 <- mismatch4^2
    bad5 <- mismatch5^2
    bad6 <- mismatch6^2
    bad7 <- mismatch7^2
    bad8 <- mismatch8^2


    allbad <- c(bad1,bad2,bad3,bad4,bad5,bad6,bad7,bad8)
#    print(c(Fx,Fy))
#    print(allbad)
    detach(knowns)

    return(sum(allbad))
}
```

`ap <- c(x01, y01, a1, x02, y02, a2, xF, yF)`.  This is six parameters.


```{r optdef}
optimand <- function(ap, knowns){
    params1 <- ap[1:3]
    params2 <- ap[4:6]
    pF      <- ap[7:8]
    badness(params1, params2, pF, knowns)
}
```

```{r dotheopt}
jj <- optim(c(c(0,0,1), c(1,0,1), c(0,0)), fn=optimand, knowns=knowns, method = "BFGS", control = list(trace=0, maxit=10000))
jj

```


```{r doplot}
jj$par

params1 <- jj$par[1:3]
params2 <- jj$par[4:6]
pF      <- jj$par[7:8]


plotter <- function(...){
attach(knowns)
plot(c(x1,x2), c(-1,2),type="n",asp=1)

x <- seq(from = x1, to = pF[1], len=50)
points(x, y(x,params1))

x <- seq(from = pF[1], to = x2, len=50)
points(x, y(x,params2))

points(x1, y1, pch=16, col='red')
points(x2, y2, pch=16, col='red')

points(pF[1],pF[2],pch=16,col='blue')

arrows(x0=pF[1],y0=pF[2], x1=pF[1]+Fx/6, y1=pF[2]+Fy/6)

detach(knowns)
}

plotter()
pdf(file="f.pdf")
plotter()
dev.off()

```




## Now streamline: keep everything constant except Fx and Fy

What I want to do is to show that the displacement is a linear
function of Fx,Fy.

```{r}
p <- function(force){

	knowns  <-
		list(
			x1  =  -1,
			y1  =  1,
			x2  =  2,
			y2  =  2,
			rho1  =  5,
			rho2  =  1,
			L1  =  2,
			L2  =  4,
			Fx  =  force[1],  # x-component of force
			Fy  =  force[2] # y-component of force
		)
	
	jj <- optim(c(c(0,0,1), c(1,0,1), c(0,0)),
                fn=optimand, knowns=knowns,
                method = "BFGS",
                control = list(trace=0, maxit=10000))

	return(jj$par[7:8])
}

(equilibrium <- p(c(0,0)))
p(c(+0.1,  0.0)) - equilibrium
p(c(-0.1,  0.0)) - equilibrium
p(c( 0.0, +0.1)) - equilibrium
p(c( 0.0, -0.1)) - equilibrium


f <- function(x){(p(c(x, 0)) - equilibrium)/x}
f(0.1)
f(0.2)
f(0.3)
f(0.4)

g <- function(x){(p(c(0, x)) - equilibrium)/x}
g(0.1)
g(0.2)
g(0.3)
g(0.4)
```

