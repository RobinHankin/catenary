---
-title: "Perturbing the Euler-Lagrange equations for calculus of variations: a first-order analysis"
author: "Robin Hankin"
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\newcommand{\di}[2]{\frac{\partial{#1}}{\partial{#2}}}
\newcommand{\cx}{\cosh{\left(\frac{x-x_0}{a}\right)}}
\newcommand{\sx}{\sinh{\left(\frac{x-x_0}{a}\right)}}
\newcommand{\tx}{\tanh{\left(\frac{x-x_0}{a}\right)}}
\newcommand{\el}[1]{\frac{d}{dx}\di{#1}{y'} - \di{#1}{y}}

Consider a functional $F=F(x,y,y';\lambda)$ and a perturbation:

\begin{eqnarray}
y  &\longrightarrow&  y(x) + \epsilon z(x)\\
y' &\longrightarrow&  y'(x) + \epsilon z'(x)\\
F  &\longrightarrow&  F + \epsilon G(x,y,y')
\end{eqnarray}


\begin{eqnarray}
\frac{d}{dx}\di{F}{y'}=\di{F}{y}\nonumber\longrightarrow\\
\frac{d}{dx}\left[\di{}{y'}\left(F(x,y+\epsilon z,y'+\epsilon z')+\epsilon G(x,y+\epsilon z,y'+\epsilon z')\right)\right] =\\
\di{}{y}\left[F(x,y+\epsilon z,y'+\epsilon z')
+\epsilon G(x,y+\epsilon z,y'+\epsilon z')\right]
\end{eqnarray}

Above we write $y$ for $y(x)$ etc.  We have to remember that
$y,y',z,z'$ are functions of $x$.  Now neglect terms of order
$\epsilon^2$ and above, and continue to neglect them:

\begin{equation}
\left(\el{G}\right) + \left(z\di{}{y} + z'\di{}{y'} + z''\di{}{y''}\right)
\left(\el{F}\right)=0
\end{equation}


# Examples.

First, straight lines as in geometrical optics

\begin{equation}
F=\sqrt{1+y'^2},\qquad G = \phi(x,y)\sqrt{1+y'^2}
\end{equation}

Here we need

\begin{eqnarray}
\el{F} &=& \frac{d}{dt}\di{F}{y'}\\
       &=& \frac{d}{dt}\frac{y'}{\sqrt{1+y'^2}}\\
       &=& \frac{y''}{(1+y'^2)^{3/2}}\\
\end{eqnarray}

and 
\begin{eqnarray}
\el{G} &=& \frac{d}{dt}\di{G}{y'} - \phi_y\sqrt{1+y'^2}\\
       &=& \frac{d}{dt}\frac{y'\phi}{\sqrt{1+y'^2}} - \phi_y\sqrt{1+y'^2}\\
       &=& \frac{y''\phi}{(1+y'^2)^{3/2}} + \frac{y'(\phi_x + y'\phi_y)}{\sqrt{1+y'^2}} - \phi_y\sqrt{1+y'^2}\\
       &=& \frac{y''\phi}{(1+y'^2)^{3/2}} + \frac{1}{\sqrt{1+y'^2}}\left(y'(\phi_x + y'\phi_y) - \phi_y-\phi_yy^2\right)\\
       &=& \frac{y''\phi}{(1+y'^2)^{3/2}} + \frac{y'\phi_x  -\phi_y}{\sqrt{1+y'^2}}
\end{eqnarray}


\begin{eqnarray}
\left(\el{G}\right) + \left(z\di{}{y} + z'\di{}{y'} + z''\di{}{y''}\right)
\left(\el{F}\right) &=& 0\\
\frac{y''\phi}{(1+y'^2)^{3/2}} + \frac{y'\phi_x - \phi_y}{\sqrt{1+y'^2}} +
\left(z\di{}{y} + z'\di{}{y'} + z''\di{}{y''}\right)
\left(\frac{y''}{(1+y'^2)^{3/2}}\right)\\
\frac{y''\phi}{(1+y'^2)^{3/2}} + \frac{y'\phi_x - \phi_y}{\sqrt{1+y'^2}} +
\left(z'\di{}{y'} + z''\di{}{y''}\right)
\left(\frac{y''}{(1+y'^2)^{3/2}}\right)\\
\frac{y''\phi}{(1+y'^2)^{3/2}} + \frac{y'\phi_x - \phi_y}{\sqrt{1+y'^2}} +
\frac{-3y'y''z'}{(1+y'^2)^{5/2}} + \frac{z''}{(1+y'^2)^{3/2}} &=&0
\end{eqnarray}


At this point we observe that $y=a+sx$ [ "$s$" for slope] and so $y'=s$ and $y''=0$:

\begin{eqnarray}
\frac{y'\phi_x - \phi_y}{\sqrt{1+y'^2}} + \frac{z''}{(1+y'^2)^{3/2}} = 0\\
\frac{s\phi_x - \phi_y}{\sqrt{1+s^2}} + \frac{z''}{(1+s^2)^{3/2}} = 0
\end{eqnarray}

simplifying,

\begin{equation}
z'' = (1+s^2)(\phi_y -s\phi_x)
\end{equation}

## Numerical work: refractive index


```{r odedefiner}
library("deSolve") 
Lorenz <- function(t, state, parameters) {
    with(as.list(c(state, parameters)), {
        dZ <- Zdash

        x <- t
        y <- t*s
        
        jj <- exp(-((x-x0)^2 + (y-y0)^2)/r^2)
        phi <- jj
        phi_x <- -2*jj*(x-x0)/r^2
        phi_y <- -2*jj*(y-y0)/r^2

        dZdash <- (1+s^2)*(phi_y - s*phi_x)

        list(c(dZ, dZdash))
    })
}

```{r odesolverrr, cache = FALSE}
parameters <- c(s = 0.1,            # "s" for slope
                 x0=5, y0=0,  r=1)  # (x0,y0) = center; radius r
state      <- c(Z = 0, Zdash = 0)   # initial conditions
times      <- seq(0, 10, by = 0.1)
out <- ode(y = state, times = times, func = Lorenz, parms = parameters)
```

```{r showode, cache=FALSE}
head(out)
tail(out)
x <- out[,1]
y <- out[,2]
plot(x,y,type='l')
grid()
```

```{r definerayfunc}
ray <- function(s, epsilon = 0.2, give = FALSE){  # s for slope
    parameters <- c(s=s, x0=5, y0=0, r=1)
    state      <- c(Z = 0, Zdash = 0)   # initial conditions
    times      <- seq(0, 10, by = 0.1)
    out <- ode(y = state, times = times, func = Lorenz, parms = parameters)
    if(give){return(out)}
    x <- out[,1]
    y <- x*s + out[,2]*epsilon
    return(cbind(x,y))
}
```


```{r, plotdelta, cache=FALSE}
plot(NA, xlim=c(0, 10), ylim=c(0, 1), asp=1)
theta <- seq(from=0, to = 2*pi, len=100)
points(5 + cos(theta), sin(theta), type="l",col="gray")
for(i in seq(from=0, to=0.4, len=15)){
    points(ray(i), type='l')
}

```

```{r, plotdeltacloseup, cache=FALSE}
plot(NA, xlim=c(6,8), ylim=c(-0.2, 0.2), asp=1)
for(i in seq(from=0, to=0.16, len=35)){
    points(ray(i), type='l', lwd=0.1)
}
```

```{r definefinaldeflection}
final_deflection <- function(s){
    jj <- ray(s, give=TRUE)
    jj[nrow(jj),3]
}

final_deflection(0.3)
final_deflection(0.31)
head(ray(0.1,give=TRUE))
tail(ray(0.1,give=TRUE))
```

```{r finaldefrange, cache=FALSE}
s <- seq(from=0, to=0.25, len=10)
fa <- sapply(s, final_deflection)
```

```{r}
plot(s, fa, type="b")
```

Find the Cartesian ray:

```{r minimizefinaldef, cache=TRUE}
optimize(final_deflection, interval = c(0.1,0.15))
```


# Catenary

Now 

\begin{equation}
F = \sqrt{1+y'^2}(y + \Lambda)\qquad G =  \sqrt{1+y'^2}(\phi + \lambda)
\end{equation}

where $\phi=\phi(x,y)$ is a small perturbation.

\begin{eqnarray}
\el{F} &=& \frac{d}{dt}\frac{yy'}{\sqrt{1+y'^2}} - \sqrt{1+y'^2}\\
       &=& \frac{y}{(1+y'^2)^{3/2}} + \frac{y'^2}{\sqrt{1+y'^2}} - \sqrt{1+y'^2}
\end{eqnarray}

and 
\begin{eqnarray}
\el{G} &=& \frac{d}{dt}\di{G}{y'} - \phi_y\sqrt{1+y'^2}\\
       &=& \frac{d}{dt}\frac{y'\phi}{\sqrt{1+y'^2}} - \phi_y\sqrt{1+y'^2}\\
       &=& \frac{y''\phi}{(1+y'^2)^{3/2}} + \frac{y'(\phi_x + y'\phi_y)}{\sqrt{1+y'^2}} - \phi_y\sqrt{1+y'^2}\\
       &=& \frac{y''\phi}{(1+y'^2)^{3/2}} + \frac{1}{\sqrt{1+y'^2}}\left(y'(\phi_x + y'\phi_y) - \phi_y-\phi_yy^2\right)\\
       &=& \frac{y''\phi}{(1+y'^2)^{3/2}} + \frac{y'\phi_x  -\phi_y}{\sqrt{1+y'^2}}
\end{eqnarray}
